---
tags:
  - 
share: "true"
---

# 04 Rozhraní Periferních Zařízení a Jejich Obsluha

## Popsat Roli Řadiče Zařízení Při Programem Řízené Obsluze Zařízení (PIO), pro Zadané Adresy a Funkce Vstupních a Výstupních Portů Implementovat Programem Řízenou Obsluhu Zadaného Zařízení (myš, disk)

- PIO = Programmed Input/Output

### Role of Device Controller in PIO

- **Basic Function**
	- Acts as an intermediary between the CPU and the peripheral device.
- **Data Transfer**
	- Manages the data transfer between system memory and device.
- **Control and Timing**
	- Synchronizes the data transfer according to the device's and CPU's speeds.
- **Buffering**
	- Sometimes includes buffers to temporarily store data during transfers.
- **Command Processing**
	- Interprets commands from the CPU to the device and vice versa.
- **Error Handling**
	- Detects and reports errors in data transfer or device operation.

### Implementing PIO for Specific Devices

- **Mouse**
	- **I/O Ports**
		- Commonly uses PS/2 or USB interfaces.
		- PS/2 mouse typically uses I/O port `0x60` for data and `0x64` for status/control.
	- **Data Handling**
		- Reads mouse movement and button click data from the data port.
		- Interprets the data to determine cursor position and actions.
	- **Example Implementation**
		- `READ_MOUSE: IN 0x60, EAX` (Read data from the mouse into the EAX register).
- **Disk**
	- **I/O Ports**
		- Hard disks often use ports like `0x1F0-0x1F7` for data and control signals.
	- **Data Handling**
		- Sends commands to the disk controller to read or write data.
		- Manages the transfer of data to/from the disk sectors.
	- **Example Implementation**
		- `READ_DISK: OUT 0x1F2, SECTOR_COUNT` (Write the number of sectors to read to the disk).
		- `OUT 0x1F3, SECTOR_NUMBER` (Write the sector number to start reading from).
		- `OUT 0x1F7, READ_COMMAND` (Send the read command to the disk).

### Practical Considerations in PIO

- **CPU Utilization**
	- High CPU involvement in data transfer, leading to inefficient CPU usage.
- **Transfer Speed**
	- Limited by CPU's ability to handle I/O operations and device speed.
- **Device Compatibility**
	- Requires specific knowledge of device ports and protocols.
- **Programming Complexity**
	- Involves low-level programming and understanding of hardware details.

## Popsat Roli Přerušení Při Programem Řízené Obsluze Zařízení (PIO), Na Úrovni Vykonávání Instrukcí Popsat Reakci Procesoru (hardware) a Operačního Systému (software) Na Žádost O Přerušení

### Role of Interrupts in PIO

- **Function in PIO**
	- Interrupts signal the CPU that a peripheral device requires attention or that a data transfer is complete.
- **Efficiency Improvement**
	- Reduces CPU idle time waiting for device operations, allowing multitasking.
- **Types of Interrupts**
	- Hardware Interrupts: Generated by hardware devices like keyboards, disks.
	- Software Interrupts: Generated by software or system calls.

### Processor (Hardware) Response to Interrupts

- **Interrupt Acknowledgement**
	- CPU acknowledges the interrupt request and determines its source.
- **Context Saving**
	- The current state of the CPU (registers, program counter) is saved for later restoration.
- **Interrupt Service Routine (ISR) Execution**
	- CPU suspends the current process and executes the relevant ISR.
- **Resuming Execution**
	- After ISR execution, the CPU restores the saved state and resumes the interrupted process.

### Operating System (Software) Response to Interrupts

- **Interrupt Handling**
	- OS handles interrupts through its interrupt handling mechanisms.
- **Task Prioritization**
	- OS prioritizes tasks based on interrupt requests, ensuring time-critical operations are handled promptly.
- **Device Drivers**
	- OS communicates with hardware through device drivers which manage the specifics of each hardware interrupt.
- **System Stability and Security**
	- OS ensures that interrupts do not compromise system stability or security.

### Practical Example: Disk I/O Operation

- **Disk Interrupt in PIO**
	- Disk sends an interrupt when a read/write operation is complete.
- **Processor Response**
	- Saves current process state.
	- Executes ISR, which typically involves OS routines to handle disk I/O.
	- Restores process state and resumes operation.
- **Operating System Involvement**
	- OS disk driver handles the data transfer from/to disk buffers.
	- OS may signal the waiting process that the I/O operation is complete.

### Additional Notes

- **Interrupt Vector Table**
	- Contains addresses of ISRs; used by the CPU to handle different types of interrupts.
- **Interrupt Masking**
	- Certain interrupts can be disabled or "masked" to prevent disturbance during critical CPU operations.
- **Nested Interrupts**
	- Handling of new interrupts while another interrupt is being processed, depending on system capabilities and settings.

